#! /usr/bin/env ruby

require 'orocos/generation'
require 'optparse'

Orocos::Generation::Component.new do |gen|
    parser = OptionParser.new do |opt|
	opt.banner = "Usage: orogen [options] <template file>"

	opt.on("--verbose") { Orocos::Generation.logger.level = Logger::INFO }
	opt.on("--debug")   { Orocos::Generation.logger.level = Logger::DEBUG }
	opt.on("--help", "this help message") do
	    puts opt
	    exit 0
	end
	opt.separator ""
	opt.on("--really-clean", "removes all autogenerated files, and user-side part that are identical to the templates") do
	    Orocos::Generation.really_clean
	    exit 0
	end
	opt.on("--clean", "removes all autogenerated files") do
	    Orocos::Generation.clean
	    exit 0
	end
    end

    files = parser.parse! ARGV
    if files.empty?
	puts parser
    else
	files.each do |name|
	    Kernel.eval(File.read(name), binding)
	end
	generate
    end
end

