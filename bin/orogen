#! /usr/bin/env ruby

require 'orocos/generation'
require 'optparse'

parser = OptionParser.new do |opt|
    opt.banner = "Usage: orogen [options] <template file>"

    opt.on("--verbose") { Orocos::Generation.logger.level = Logger::INFO }
    opt.on("--debug")   { Orocos::Generation.logger.level = Logger::DEBUG }
    opt.on("--help", "this help message") do
        puts opt
        exit 0
    end
    opt.separator ""
    opt.on("--really-clean", "removes all autogenerated files, and user-side part that are identical to the templates") do
        Orocos::Generation.really_clean
        exit 0
    end
    opt.on("--clean", "removes all autogenerated files") do
        Orocos::Generation.clean
        exit 0
    end
end
files = parser.parse! ARGV
if files.size != 1
    puts parser
    exit 1
end

filename = files.first
Orocos::Generation::Component.new(File.expand_path(filename)) do |gen|
    Kernel.eval(File.read(filename), binding)
    generate
end

