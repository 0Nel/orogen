#! /usr/bin/env ruby

require 'orocos/generation'
require 'optparse'

component = Orocos::Generation::Component.new do |gen|
    parser = OptionParser.new do |opt|
	opt.banner = "Usage: orogen [options] <template file>"
	opt.on("--cleanup", "removes all autogenerated files") do
	    FileUtils.rm_f ".orocos"
	    FileUtils.rm_f "build"
	    exit 0
	end
	opt.separator ""

	opt.on("--verbose") { Orocos::Generation.logger.level = Logger::INFO }
	opt.on("--debug")   { Orocos::Generation.logger.level = Logger::DEBUG }
	opt.on("--help", "this help message") do
	    puts opt
	    exit 0
	end
    end

    files = parser.parse! ARGV
    if files.empty?
	puts parser
    else
	files.each do |name|
	    Kernel.eval(File.read(name), binding)
	end
	component.generate
    end
end

